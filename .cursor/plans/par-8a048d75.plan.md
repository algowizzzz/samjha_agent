<!-- 8a048d75-5918-4afa-a32c-f0e3679642f9 acacfa95-85da-4f7d-b6c9-df2268afb179 -->
# UI Improvements for Streaming Agent Chat

### To-dos

- [ ] Create AgentState schema with previous_sessions, control, plan/execution fields
- [ ] Add DuckDB tables and state manager for save/load last two sessions
- [ ] Implement invoke, planner, clarify, execute, evaluate, end nodes
- [ ] Add nl_to_sql_planner tool with confidence and questions output
- [ ] Add query_safety_validator enforcing allowed paths/limits
- [ ] Add query_result_evaluator with heuristics and optional LLM
- [ ] Build parquet_agent orchestrator wiring control loop
- [ ] Expose agent as MCP tool returning full state
- [ ] Add JSON configs for agent and new tools in config/tools
- [ ] Add unit/integration tests for plan→execute→evaluate loop and clarify